# -*- coding: utf-8 -*-
"""dataset.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/10eJ-mJLTJqOLs1qxh4wmC42GLH1zUhn7
"""

import os
from torch.utils.data import Dataset, DataLoader
from PIL import Image
import numpy as np

class Carla(Dataset):
  def __init__(self, path, transform = None):
    self.root_dir = path
    self.img_path = os.path.join(self.root_dir,'CameraRGB/')
    self.label_path = os.path.join(self.root_dir,'CameraSeg/')
    assert len(os.listdir(self.img_path)) == len(os.listdir(self.label_path))
    self.transform = transform

  def __len__(self):
    return len(os.listdir(self.label_path))
  
  def __getitem__(self, index):
    image = np.array(Image.open(self.img_path + str(index) + '.png'))
    label = np.array(Image.open(self.label_path + str(index) + '.png'))

    if self.transform is not None:
      augmentation = self.transform(image=image,mask=label)
      image = augmentation['image'].permute(1,2,0)
      label = augmentation['mask']
      
      return image/255, label
